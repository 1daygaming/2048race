(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))h(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&h(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function h(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();const l=400,o=600,w={HITBOX:"#ff0000",PLAYER_HITBOX:"#00ff00",TRAILER_HITBOX:"#0000ff"},m=40,f=30,g=40,y=30,S=5,u=m,p=f+S+y,L=300,O="#3498db",n=40,B="#2ecc71",N=60,A=40,R="#e74c3c",d=200,C=1.15,M=2e3,P=1500,_=100;class x{x;y;width;height;color;constructor(e,t,h,i,s){this.x=e,this.y=t,this.width=h,this.height=i,this.color=s}draw(e){e.fillStyle=this.color,e.fillRect(this.x,this.y,this.width,this.height),this.drawHitbox(e)}drawHitbox(e,t=w.HITBOX){e.save(),e.strokeStyle=t,e.lineWidth=2,e.setLineDash([5,5]),e.strokeRect(this.x,this.y,this.width,this.height),e.restore()}getPosition(){return{x:this.x,y:this.y}}getBounds(){return{x:this.x,y:this.y,width:this.width,height:this.height}}collidesWith(e){const t=this.getBounds(),h=e.getBounds();return t.x<h.x+h.width&&t.x+t.width>h.x&&t.y<h.y+h.height&&t.y+t.height>h.y}}class c{static images=new Map;static loadPromises=[];static loadImage(e,t){const h=new Image,i=new Promise((s,a)=>{h.onload=()=>{this.images.set(e,h),s()},h.onerror=()=>a(new Error(`Failed to load image: ${t}`))});h.src=t,this.loadPromises.push(i)}static getImage(e){return this.images.get(e)}static async waitForLoad(){await Promise.all(this.loadPromises)}}class b extends x{speed;currentNumber;moving;constructor(){const e=(l-u)/2,t=o-p-_;super(e,t,u,p,O),this.speed=L,this.currentNumber=2,this.moving={left:!1,right:!1},this.setupControls()}setupControls(){window.addEventListener("keydown",t=>{t.key==="ArrowLeft"&&(this.moving.left=!0),t.key==="ArrowRight"&&(this.moving.right=!0)}),window.addEventListener("keyup",t=>{t.key==="ArrowLeft"&&(this.moving.left=!1),t.key==="ArrowRight"&&(this.moving.right=!1)});const e=t=>{const h=t.touches[0],i=window.innerWidth/2;this.moving.left=h.clientX<i,this.moving.right=h.clientX>=i,t.preventDefault()};window.addEventListener("touchstart",e),window.addEventListener("touchmove",e),window.addEventListener("touchend",()=>{this.moving.left=!1,this.moving.right=!1})}update(e){this.moving.left&&(this.x-=this.speed*e),this.moving.right&&(this.x+=this.speed*e),this.x=Math.max(0,Math.min(this.x,l-this.width))}draw(e){const t=c.getImage("truck"),h=c.getImage("trailer");if(t&&h){e.drawImage(t,this.x,this.y,m,f);const i=this.x+(m-g)/2,s=this.y+f+S;e.drawImage(h,i,s,g,y),e.fillStyle="white",e.font='16px "Press Start 2P"',e.textAlign="center",e.textBaseline="middle",e.fillText(this.currentNumber.toString(),i+g/2,s+y/2),this.drawHitbox(e,w.PLAYER_HITBOX),e.save(),e.strokeStyle=w.HITBOX,e.lineWidth=2,e.setLineDash([5,5]),e.strokeRect(this.x,this.y,m,f),e.restore(),e.save(),e.strokeStyle=w.TRAILER_HITBOX,e.lineWidth=2,e.setLineDash([5,5]),e.strokeRect(i,s,g,y),e.restore()}else super.draw(e)}getCurrentNumber(){return this.currentNumber}updateNumber(e){this.currentNumber=Math.max(2,e)}}class v extends x{value;speed;constructor(e,t,h){super(e,t,n,n,B),this.value=h,this.speed=d}update(e){this.y+=this.speed*e}draw(e){const t=c.getImage("number");t?(e.drawImage(t,this.x,this.y,this.width,this.height),e.fillStyle="white",e.font="16px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText(this.value.toString(),this.x+this.width/2,this.y+this.height/2)):super.draw(e)}getValue(){return this.value}setSpeed(e){this.speed=e}}class I extends x{speed;type;constructor(e,t){super(e,t,N,A,R),this.speed=d;const h=["pothole","barrier","broken-car"];this.type=h[Math.floor(Math.random()*h.length)]}draw(e){const t=c.getImage(this.type);t?e.drawImage(t,this.x,this.y,this.width,this.height):super.draw(e)}update(e){this.y+=this.speed*e}setSpeed(e){this.speed=e}}const k="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20width='60'%20height='40'%20viewBox='0%200%2060%2040'%20xmlns='http://www.w3.org/2000/svg'%3e%3c!--%20Пиксельная%20машина%20--%3e%3cg%20transform='scale(4)'%3e%3c!--%20Основной%20корпус%20(3x5%20пикселей)%20--%3e%3crect%20x='4'%20y='2'%20width='1'%20height='1'%20fill='%234a90e2'/%3e%3crect%20x='5'%20y='2'%20width='1'%20height='1'%20fill='%234a90e2'/%3e%3crect%20x='6'%20y='2'%20width='1'%20height='1'%20fill='%234a90e2'/%3e%3crect%20x='4'%20y='3'%20width='1'%20height='1'%20fill='%234a90e2'/%3e%3crect%20x='5'%20y='3'%20width='1'%20height='1'%20fill='%235d9eeb'/%3e%3crect%20x='6'%20y='3'%20width='1'%20height='1'%20fill='%234a90e2'/%3e%3crect%20x='4'%20y='4'%20width='1'%20height='1'%20fill='%234a90e2'/%3e%3crect%20x='5'%20y='4'%20width='1'%20height='1'%20fill='%234a90e2'/%3e%3crect%20x='6'%20y='4'%20width='1'%20height='1'%20fill='%234a90e2'/%3e%3crect%20x='4'%20y='5'%20width='1'%20height='1'%20fill='%234a90e2'/%3e%3crect%20x='5'%20y='5'%20width='1'%20height='1'%20fill='%235d9eeb'/%3e%3crect%20x='6'%20y='5'%20width='1'%20height='1'%20fill='%234a90e2'/%3e%3crect%20x='4'%20y='6'%20width='1'%20height='1'%20fill='%234a90e2'/%3e%3crect%20x='5'%20y='6'%20width='1'%20height='1'%20fill='%234a90e2'/%3e%3crect%20x='6'%20y='6'%20width='1'%20height='1'%20fill='%234a90e2'/%3e%3c!--%20Фары%20--%3e%3crect%20x='4'%20y='2'%20width='1'%20height='1'%20fill='%23f1c40f'/%3e%3crect%20x='6'%20y='2'%20width='1'%20height='1'%20fill='%23f1c40f'/%3e%3c!--%20Колеса%20(1x1%20пиксель%20каждое)%20--%3e%3crect%20x='3'%20y='3'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3crect%20x='7'%20y='3'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3crect%20x='3'%20y='5'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3crect%20x='7'%20y='5'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3c/g%3e%3c/svg%3e",H="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20width='30'%20height='40'%20viewBox='0%200%2030%2040'%20xmlns='http://www.w3.org/2000/svg'%3e%3c!--%20Пиксельный%20прицеп%20--%3e%3cg%20transform='scale(4)'%3e%3c!--%20Основной%20корпус%20(5x7%20пикселей)%20--%3e%3crect%20x='1'%20y='1'%20width='1'%20height='1'%20fill='%2334495e'/%3e%3crect%20x='2'%20y='1'%20width='1'%20height='1'%20fill='%2334495e'/%3e%3crect%20x='3'%20y='1'%20width='1'%20height='1'%20fill='%2334495e'/%3e%3crect%20x='4'%20y='1'%20width='1'%20height='1'%20fill='%2334495e'/%3e%3crect%20x='5'%20y='1'%20width='1'%20height='1'%20fill='%2334495e'/%3e%3crect%20x='1'%20y='2'%20width='1'%20height='1'%20fill='%2334495e'/%3e%3crect%20x='2'%20y='2'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3crect%20x='3'%20y='2'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3crect%20x='4'%20y='2'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3crect%20x='5'%20y='2'%20width='1'%20height='1'%20fill='%2334495e'/%3e%3crect%20x='1'%20y='3'%20width='1'%20height='1'%20fill='%2334495e'/%3e%3crect%20x='2'%20y='3'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3crect%20x='3'%20y='3'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3crect%20x='4'%20y='3'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3crect%20x='5'%20y='3'%20width='1'%20height='1'%20fill='%2334495e'/%3e%3crect%20x='1'%20y='4'%20width='1'%20height='1'%20fill='%2334495e'/%3e%3crect%20x='2'%20y='4'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3crect%20x='3'%20y='4'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3crect%20x='4'%20y='4'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3crect%20x='5'%20y='4'%20width='1'%20height='1'%20fill='%2334495e'/%3e%3crect%20x='1'%20y='5'%20width='1'%20height='1'%20fill='%2334495e'/%3e%3crect%20x='2'%20y='5'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3crect%20x='3'%20y='5'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3crect%20x='4'%20y='5'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3crect%20x='5'%20y='5'%20width='1'%20height='1'%20fill='%2334495e'/%3e%3crect%20x='1'%20y='6'%20width='1'%20height='1'%20fill='%2334495e'/%3e%3crect%20x='2'%20y='6'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3crect%20x='3'%20y='6'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3crect%20x='4'%20y='6'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3crect%20x='5'%20y='6'%20width='1'%20height='1'%20fill='%2334495e'/%3e%3crect%20x='1'%20y='7'%20width='1'%20height='1'%20fill='%2334495e'/%3e%3crect%20x='2'%20y='7'%20width='1'%20height='1'%20fill='%2334495e'/%3e%3crect%20x='3'%20y='7'%20width='1'%20height='1'%20fill='%2334495e'/%3e%3crect%20x='4'%20y='7'%20width='1'%20height='1'%20fill='%2334495e'/%3e%3crect%20x='5'%20y='7'%20width='1'%20height='1'%20fill='%2334495e'/%3e%3c!--%20Колеса%20--%3e%3crect%20x='0'%20y='2'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3crect%20x='6'%20y='2'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3crect%20x='0'%20y='6'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3crect%20x='6'%20y='6'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3c/g%3e%3c/svg%3e",G="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20width='40'%20height='40'%20viewBox='0%200%2040%2040'%20xmlns='http://www.w3.org/2000/svg'%3e%3c!--%20Пиксельный%20блок%20с%20числом%20--%3e%3cg%20transform='scale(4)'%3e%3c!--%20Рамка%20(8x8%20пикселей)%20--%3e%3crect%20x='1'%20y='1'%20width='8'%20height='8'%20fill='%232ecc71'/%3e%3crect%20x='2'%20y='2'%20width='6'%20height='6'%20fill='%2327ae60'/%3e%3c!--%20Пиксельные%20блики%20--%3e%3crect%20x='2'%20y='2'%20width='1'%20height='1'%20fill='%232ecc71'/%3e%3crect%20x='3'%20y='2'%20width='1'%20height='1'%20fill='%232ecc71'/%3e%3crect%20x='2'%20y='3'%20width='1'%20height='1'%20fill='%232ecc71'/%3e%3c!--%20Пиксельные%20тени%20--%3e%3crect%20x='7'%20y='7'%20width='1'%20height='1'%20fill='%23219a52'/%3e%3crect%20x='6'%20y='7'%20width='1'%20height='1'%20fill='%23219a52'/%3e%3crect%20x='7'%20y='6'%20width='1'%20height='1'%20fill='%23219a52'/%3e%3c/g%3e%3c/svg%3e",D="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20width='40'%20height='40'%20viewBox='0%200%2040%2040'%20xmlns='http://www.w3.org/2000/svg'%3e%3c!--%20Пиксельная%20яма%20--%3e%3cg%20transform='scale(4)'%3e%3c!--%20Основная%20форма%20(6x6%20пикселей)%20--%3e%3crect%20x='2'%20y='2'%20width='1'%20height='1'%20fill='%2334495e'/%3e%3crect%20x='3'%20y='2'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3crect%20x='4'%20y='2'%20width='1'%20height='1'%20fill='%2334495e'/%3e%3crect%20x='5'%20y='2'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3crect%20x='2'%20y='3'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3crect%20x='3'%20y='3'%20width='1'%20height='1'%20fill='%231a1a1a'/%3e%3crect%20x='4'%20y='3'%20width='1'%20height='1'%20fill='%231a1a1a'/%3e%3crect%20x='5'%20y='3'%20width='1'%20height='1'%20fill='%2334495e'/%3e%3crect%20x='2'%20y='4'%20width='1'%20height='1'%20fill='%2334495e'/%3e%3crect%20x='3'%20y='4'%20width='1'%20height='1'%20fill='%231a1a1a'/%3e%3crect%20x='4'%20y='4'%20width='1'%20height='1'%20fill='%231a1a1a'/%3e%3crect%20x='5'%20y='4'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3crect%20x='2'%20y='5'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3crect%20x='3'%20y='5'%20width='1'%20height='1'%20fill='%2334495e'/%3e%3crect%20x='4'%20y='5'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3crect%20x='5'%20y='5'%20width='1'%20height='1'%20fill='%2334495e'/%3e%3c/g%3e%3c/svg%3e",U="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20width='40'%20height='40'%20viewBox='0%200%2040%2040'%20xmlns='http://www.w3.org/2000/svg'%3e%3c!--%20Пиксельный%20барьер%20--%3e%3cg%20transform='scale(4)'%3e%3c!--%20Основная%20форма%20(8x4%20пикселей)%20--%3e%3crect%20x='1'%20y='3'%20width='8'%20height='1'%20fill='%23e74c3c'/%3e%3crect%20x='1'%20y='4'%20width='8'%20height='1'%20fill='%23c0392b'/%3e%3c!--%20Полосы%20--%3e%3crect%20x='2'%20y='3'%20width='1'%20height='1'%20fill='%23c0392b'/%3e%3crect%20x='4'%20y='3'%20width='1'%20height='1'%20fill='%23c0392b'/%3e%3crect%20x='6'%20y='3'%20width='1'%20height='1'%20fill='%23c0392b'/%3e%3c!--%20Стойки%20--%3e%3crect%20x='2'%20y='2'%20width='1'%20height='1'%20fill='%2395a5a6'/%3e%3crect%20x='2'%20y='5'%20width='1'%20height='1'%20fill='%2395a5a6'/%3e%3crect%20x='6'%20y='2'%20width='1'%20height='1'%20fill='%2395a5a6'/%3e%3crect%20x='6'%20y='5'%20width='1'%20height='1'%20fill='%2395a5a6'/%3e%3c/g%3e%3c/svg%3e",W="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20width='40'%20height='40'%20viewBox='0%200%2040%2040'%20xmlns='http://www.w3.org/2000/svg'%3e%3c!--%20Пиксельная%20сломанная%20машина%20--%3e%3cg%20transform='scale(4)'%3e%3c!--%20Основной%20корпус%20--%3e%3crect%20x='2'%20y='3'%20width='6'%20height='4'%20fill='%23e74c3c'/%3e%3c!--%20Детали%20повреждений%20--%3e%3crect%20x='2'%20y='3'%20width='2'%20height='2'%20fill='%23c0392b'/%3e%3crect%20x='6'%20y='4'%20width='2'%20height='2'%20fill='%23c0392b'/%3e%3c!--%20Разбитые%20окна%20--%3e%3crect%20x='3'%20y='4'%20width='1'%20height='1'%20fill='%2395a5a6'/%3e%3crect%20x='5'%20y='4'%20width='1'%20height='1'%20fill='%2395a5a6'/%3e%3c!--%20Колеса%20--%3e%3crect%20x='2'%20y='7'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3crect%20x='6'%20y='7'%20width='1'%20height='1'%20fill='%232c3e50'/%3e%3c!--%20Дым%20--%3e%3crect%20x='4'%20y='2'%20width='1'%20height='1'%20fill='%237f8c8d'/%3e%3crect%20x='5'%20y='1'%20width='1'%20height='1'%20fill='%237f8c8d'/%3e%3crect%20x='6'%20y='2'%20width='1'%20height='1'%20fill='%237f8c8d'/%3e%3c/g%3e%3c/svg%3e",F="/2048race/assets/background-BlC9AS4N.png";class X{canvas;ctx;player;gameObjects;lastTime;gameSpeed;score;maxNumber;numberSpawnTime;obstacleSpawnTime;isGameOver;constructor(e){this.canvas=document.getElementById(e),this.ctx=this.canvas.getContext("2d"),this.canvas.width=l,this.canvas.height=o,this.loadAssets(),this.player=new b,this.gameObjects=[],this.lastTime=0,this.gameSpeed=d,this.score=0,this.maxNumber=2,this.numberSpawnTime=0,this.obstacleSpawnTime=0,this.isGameOver=!1,this.gameLoop=this.gameLoop.bind(this)}loadAssets(){c.loadImage("truck",k),c.loadImage("trailer",H),c.loadImage("number",G),c.loadImage("pothole",D),c.loadImage("barrier",U),c.loadImage("broken-car",W),c.loadImage("background",F)}async start(){await c.waitForLoad(),this.isGameOver=!1,this.score=2,this.maxNumber=2,this.gameSpeed=d,this.gameObjects=[],this.player=new b,requestAnimationFrame(this.gameLoop)}gameLoop(e){if(this.isGameOver)return;const t=(e-this.lastTime)/1e3;this.lastTime=e,this.update(t),this.draw(),requestAnimationFrame(this.gameLoop)}getCurrentGameSpeed(){const e=this.player.getCurrentNumber(),t=Math.log2(e)-1;return d*Math.pow(C,t)}update(e){this.player.update(e),this.gameSpeed=this.getCurrentGameSpeed(),this.gameObjects=this.gameObjects.filter(t=>(t.setSpeed(this.gameSpeed),t.update(e),t.getPosition().y<=o)),this.checkCollisions(),this.numberSpawnTime+=e*1e3,this.obstacleSpawnTime+=e*1e3,this.numberSpawnTime>=M&&(this.spawnNumber(),this.numberSpawnTime=0),this.obstacleSpawnTime>=P&&(this.spawnObstacle(),this.obstacleSpawnTime=0)}draw(){this.ctx.fillStyle="#0a0a0a",this.ctx.fillRect(0,0,l,o),this.ctx.strokeStyle="#1a1a1a",this.ctx.lineWidth=1;for(let e=0;e<l;e+=20)this.ctx.beginPath(),this.ctx.moveTo(e,0),this.ctx.lineTo(e,o),this.ctx.stroke();this.gameObjects.forEach(e=>e.draw(this.ctx)),this.player.draw(this.ctx),this.ctx.font='bold 24px "Press Start 2P", monospace',this.ctx.textAlign="left",this.ctx.shadowColor="#00ff00",this.ctx.shadowBlur=10,this.ctx.fillStyle="#fff",this.ctx.fillText(`MAX: ${this.score}`,10,30),this.ctx.shadowBlur=0}checkCollisions(){this.gameObjects.forEach(e=>{this.player.collidesWith(e)&&(e instanceof v?this.handleNumberCollision(e):e instanceof I&&this.handleObstacleCollision(),this.gameObjects=this.gameObjects.filter(t=>t!==e))})}handleNumberCollision(e){const t=this.player.getCurrentNumber(),h=e.getValue();if(t===h){const i=t*2;this.player.updateNumber(i),i>this.maxNumber&&(this.maxNumber=i,this.score=this.maxNumber)}else this.player.updateNumber(Math.max(2,Math.floor(t/4)))}handleObstacleCollision(){const e=this.player.getCurrentNumber();this.player.updateNumber(Math.max(2,Math.floor(e/8)))}spawnNumber(){const e=this.player.getCurrentNumber(),t=[e/2,e,e*2].filter(a=>a>=2),h=t[Math.floor(Math.random()*t.length)],i=Math.random()*(l-n),s=new v(i,-40,h);s.setSpeed(this.gameSpeed),this.gameObjects.push(s)}spawnObstacle(){const e=Math.floor(Math.random()*3)+1;for(let t=0;t<e;t++){const h=Math.random()*100-50,i=Math.min(Math.max(Math.random()*(l-n)+h,0),l-n),s=new I(i,-40-t*20);s.setSpeed(this.gameSpeed),this.gameObjects.push(s)}}}const j=document.getElementById("startScreen"),Y=document.getElementById("startButton"),V=document.getElementById("rulesButton"),E=document.getElementById("rulesModal"),q=document.getElementById("closeRules"),T=document.getElementById("gameCanvas"),K=document.getElementById("startScreenBackground"),$=new X("gameCanvas");c.waitForLoad().then(()=>{const r=c.getImage("background");r&&(K.src=r.src)});Y.addEventListener("click",()=>{j.style.display="none",T.style.display="block",$.start()});V.addEventListener("click",()=>{E.style.display="flex"});q.addEventListener("click",()=>{E.style.display="none"});T.style.display="none";
